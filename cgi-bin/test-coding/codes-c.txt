#include <iostream>   
#include <stdio.h>  
#include <stdlib.h> 
#include <string.h>
#pragma warning(disable:4996)

using namespace std;

bool valid_login(char username[25], char password[25])
{
	FILE *f = fopen("C:\\xampp\\htdocs\\cgi-app\\cgi-bin\\test.txt", "r");
	char buffer[100] = " ";
	char line[100] = "";
	if (f == NULL)
	{
		cout << "Fehler beim einlesen der Datei";
		return NULL;
	}

	while (!feof(f))
	{
		fread(buffer, sizeof(line), 20, f);
	}

	cout << "username:" << username;
	cout << "password:" << password;

	strcat(line, username);
	strcat(line, ":");
	strcat(line, password);
	strcat(line, "\n");

	if (strstr(buffer, line) == NULL)
		return false;
	else
		return true;
}



int main() {
	const char *len_;
	char len = 0;
	char *postdata;
	char username[25];
	char password[25];


	cout << "Content-type:text/html\r\n\r\n";
	cout << "<html>\n";
	cout << "<head>\n";
	cout << "<title>Using GET and POST Methods</title>\n";
	cout << "</head>\n";
	cout << "<body>\n";

	len_ = getenv("CONTENT_LENGTH");
	len = strtol(len_, NULL, 10);
	postdata = (char*) malloc(len + 1);
	if (!postdata) { /* handle error or */ exit(EXIT_FAILURE); }
	fgets(postdata, len + 1, stdin);
	/* work with postdata */

	cout << postdata;

	// TODO find username= string n postdata string -> string operations
	// TODO find password= string n postdata string -> string operations

	cout << valid_login("masteralam", "masteralam");

	if (valid_login("masteralam", "masteralam"))
		// TODO redirect to other html page
		cout << "login ok";
	else
		// TODO dont do anything
		cout << "login wrong";


	free(postdata);

	//system("pause");
	cout << "<br/>\n";
	cout << "</body>\n";
	cout << "</html>\n";

	return 0;
}

